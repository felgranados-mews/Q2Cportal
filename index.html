<script>
  document.addEventListener("DOMContentLoaded", () => {
    function renderEbba() {
      if (window.GleanWebSDK && typeof GleanWebSDK.renderChat === "function") {
        GleanWebSDK.renderChat(document.getElementById("glean-app"), {
          agentId: "4e47a05a92a34639a076aad88ce881bb"
        });
        waitForEbbaInput();
      } else {
        setTimeout(renderEbba, 100);
      }
    }

    renderEbba();
  });

  // More robust waiting function
  function waitForEbbaInput() {
    let attempts = 0;
    const interval = setInterval(() => {
      const input = document.querySelector("input[type='text']");
      const form = input?.closest("form");

      if (input && form) {
        input.value = "Can you show me all open tickets for my account?";
        input.dispatchEvent(new Event("input", { bubbles: true }));

        setTimeout(() => {
          form.dispatchEvent(new Event("submit", { bubbles: true }));
        }, 300);

        clearInterval(interval);
      } else {
        attempts++;
        if (attempts > 30) clearInterval(interval); // stop after ~10s
      }
    }, 300); // retry every 300ms
  }
</script>
